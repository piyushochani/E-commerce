{"ast":null,"code":"import React,{createContext,useState,useEffect,useContext,useCallback}from'react';import{cartService}from'../services/cartService';import{AuthContext}from'./AuthContext';import{jsx as _jsx}from\"react/jsx-runtime\";export const CartContext=/*#__PURE__*/createContext();export const CartProvider=_ref=>{let{children}=_ref;const[cart,setCart]=useState(null);const[cartItems,setCartItems]=useState([]);const[loading,setLoading]=useState(false);// Get auth context with safety check\nconst authContext=useContext(AuthContext);const{isCustomer,isAuthenticated,loading:authLoading}=authContext||{};const fetchCart=useCallback(async()=>{// Wait for auth to finish loading\nif(authLoading)return;// Only fetch cart if user is authenticated and is a customer\nif(!isCustomer||!isAuthenticated){setCart(null);setCartItems([]);return;}try{setLoading(true);const response=await cartService.getCart();setCart(response.data.cart);setCartItems(response.data.cartItems||[]);}catch(error){var _error$response,_error$response2;// Only log error if it's not authentication related\nif(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)!==401&&((_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.status)!==404){console.error('Error fetching cart:',error.message);}// Set empty cart on error\nsetCart(null);setCartItems([]);}finally{setLoading(false);}},[isCustomer,isAuthenticated,authLoading]);useEffect(()=>{// Don't fetch until auth is done loading\nif(!authLoading){if(isCustomer&&isAuthenticated){fetchCart();}else{// Clear cart if not a customer\nsetCart(null);setCartItems([]);}}},[isCustomer,isAuthenticated,authLoading,fetchCart]);const addToCart=async function(productId){let quantity=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;if(!isCustomer||!isAuthenticated){return{success:false,error:'Please login as customer'};}try{await cartService.addToCart(productId,quantity);await fetchCart();return{success:true};}catch(error){var _error$response3,_error$response3$data;console.error('Add to cart error:',error);return{success:false,error:((_error$response3=error.response)===null||_error$response3===void 0?void 0:(_error$response3$data=_error$response3.data)===null||_error$response3$data===void 0?void 0:_error$response3$data.message)||'Failed to add to cart'};}};const updateCartItem=async(cartItemId,quantity)=>{try{await cartService.updateCartItem(cartItemId,quantity);await fetchCart();return{success:true};}catch(error){var _error$response4,_error$response4$data;console.error('Update cart error:',error);return{success:false,error:((_error$response4=error.response)===null||_error$response4===void 0?void 0:(_error$response4$data=_error$response4.data)===null||_error$response4$data===void 0?void 0:_error$response4$data.message)||'Failed to update cart'};}};const removeFromCart=async cartItemId=>{try{await cartService.removeFromCart(cartItemId);await fetchCart();return{success:true};}catch(error){var _error$response5,_error$response5$data;console.error('Remove from cart error:',error);return{success:false,error:((_error$response5=error.response)===null||_error$response5===void 0?void 0:(_error$response5$data=_error$response5.data)===null||_error$response5$data===void 0?void 0:_error$response5$data.message)||'Failed to remove from cart'};}};const clearCart=async()=>{try{await cartService.clearCart();await fetchCart();return{success:true};}catch(error){var _error$response6,_error$response6$data;console.error('Clear cart error:',error);return{success:false,error:((_error$response6=error.response)===null||_error$response6===void 0?void 0:(_error$response6$data=_error$response6.data)===null||_error$response6$data===void 0?void 0:_error$response6$data.message)||'Failed to clear cart'};}};const getCartCount=()=>{return(cart===null||cart===void 0?void 0:cart.cart_quantity)||0;};const getCartTotal=()=>{return(cart===null||cart===void 0?void 0:cart.cart_total_amount)||0;};return/*#__PURE__*/_jsx(CartContext.Provider,{value:{cart,cartItems,loading,fetchCart,addToCart,updateCartItem,removeFromCart,clearCart,getCartCount,getCartTotal},children:children});};","map":{"version":3,"names":["React","createContext","useState","useEffect","useContext","useCallback","cartService","AuthContext","jsx","_jsx","CartContext","CartProvider","_ref","children","cart","setCart","cartItems","setCartItems","loading","setLoading","authContext","isCustomer","isAuthenticated","authLoading","fetchCart","response","getCart","data","error","_error$response","_error$response2","status","console","message","addToCart","productId","quantity","arguments","length","undefined","success","_error$response3","_error$response3$data","updateCartItem","cartItemId","_error$response4","_error$response4$data","removeFromCart","_error$response5","_error$response5$data","clearCart","_error$response6","_error$response6$data","getCartCount","cart_quantity","getCartTotal","cart_total_amount","Provider","value"],"sources":["C:/Users/piyus/OneDrive/Documents/Workspaces/E-commerce/frontend/src/context/CartContext.jsx"],"sourcesContent":["import React, { createContext, useState, useEffect, useContext, useCallback } from 'react';\r\nimport { cartService } from '../services/cartService';\r\nimport { AuthContext } from './AuthContext';\r\n\r\nexport const CartContext = createContext();\r\n\r\nexport const CartProvider = ({ children }) => {\r\n  const [cart, setCart] = useState(null);\r\n  const [cartItems, setCartItems] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  \r\n  // Get auth context with safety check\r\n  const authContext = useContext(AuthContext);\r\n  const { isCustomer, isAuthenticated, loading: authLoading } = authContext || {};\r\n\r\n  const fetchCart = useCallback(async () => {\r\n    // Wait for auth to finish loading\r\n    if (authLoading) return;\r\n    \r\n    // Only fetch cart if user is authenticated and is a customer\r\n    if (!isCustomer || !isAuthenticated) {\r\n      setCart(null);\r\n      setCartItems([]);\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      setLoading(true);\r\n      const response = await cartService.getCart();\r\n      setCart(response.data.cart);\r\n      setCartItems(response.data.cartItems || []);\r\n    } catch (error) {\r\n      // Only log error if it's not authentication related\r\n      if (error.response?.status !== 401 && error.response?.status !== 404) {\r\n        console.error('Error fetching cart:', error.message);\r\n      }\r\n      // Set empty cart on error\r\n      setCart(null);\r\n      setCartItems([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [isCustomer, isAuthenticated, authLoading]);\r\n\r\n  useEffect(() => {\r\n    // Don't fetch until auth is done loading\r\n    if (!authLoading) {\r\n      if (isCustomer && isAuthenticated) {\r\n        fetchCart();\r\n      } else {\r\n        // Clear cart if not a customer\r\n        setCart(null);\r\n        setCartItems([]);\r\n      }\r\n    }\r\n  }, [isCustomer, isAuthenticated, authLoading, fetchCart]);\r\n\r\n  const addToCart = async (productId, quantity = 1) => {\r\n    if (!isCustomer || !isAuthenticated) {\r\n      return { success: false, error: 'Please login as customer' };\r\n    }\r\n\r\n    try {\r\n      await cartService.addToCart(productId, quantity);\r\n      await fetchCart();\r\n      return { success: true };\r\n    } catch (error) {\r\n      console.error('Add to cart error:', error);\r\n      return { success: false, error: error.response?.data?.message || 'Failed to add to cart' };\r\n    }\r\n  };\r\n\r\n  const updateCartItem = async (cartItemId, quantity) => {\r\n    try {\r\n      await cartService.updateCartItem(cartItemId, quantity);\r\n      await fetchCart();\r\n      return { success: true };\r\n    } catch (error) {\r\n      console.error('Update cart error:', error);\r\n      return { success: false, error: error.response?.data?.message || 'Failed to update cart' };\r\n    }\r\n  };\r\n\r\n  const removeFromCart = async (cartItemId) => {\r\n    try {\r\n      await cartService.removeFromCart(cartItemId);\r\n      await fetchCart();\r\n      return { success: true };\r\n    } catch (error) {\r\n      console.error('Remove from cart error:', error);\r\n      return { success: false, error: error.response?.data?.message || 'Failed to remove from cart' };\r\n    }\r\n  };\r\n\r\n  const clearCart = async () => {\r\n    try {\r\n      await cartService.clearCart();\r\n      await fetchCart();\r\n      return { success: true };\r\n    } catch (error) {\r\n      console.error('Clear cart error:', error);\r\n      return { success: false, error: error.response?.data?.message || 'Failed to clear cart' };\r\n    }\r\n  };\r\n\r\n  const getCartCount = () => {\r\n    return cart?.cart_quantity || 0;\r\n  };\r\n\r\n  const getCartTotal = () => {\r\n    return cart?.cart_total_amount || 0;\r\n  };\r\n\r\n  return (\r\n    <CartContext.Provider\r\n      value={{\r\n        cart,\r\n        cartItems,\r\n        loading,\r\n        fetchCart,\r\n        addToCart,\r\n        updateCartItem,\r\n        removeFromCart,\r\n        clearCart,\r\n        getCartCount,\r\n        getCartTotal\r\n      }}\r\n    >\r\n      {children}\r\n    </CartContext.Provider>\r\n  );\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}